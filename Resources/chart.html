<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <script src="https://s3.tradingview.com/tv.js"></script>
</head>
<body style="margin:0">
<div id="tv_chart_container" style="width:100%;height:100vh;"></div>
<script>
const params = new URLSearchParams(location.search);
const symbol = (params.get('symbol') || 'BTCUSDT').toUpperCase();
const interval = (params.get('interval') || '1m').toLowerCase();

const intervalMap = {
    '1m': '1',
    '5m': '5',
    '15m': '15',
    '1h': '60',
    '4h': '240',
    '1d': '1D'
};

async function loadChart() {
    const container = document.getElementById('tv_chart_container');
    try {
        // Binance futures'ta sembol var mı kontrol et
        const resp = await fetch(`https://fapi.binance.com/fapi/v1/exchangeInfo?symbol=${symbol}`);
        const data = await resp.json();
        if (!data.symbols || data.symbols.length === 0) {
            container.innerHTML = '<div style="color:red;padding:20px;">Sembol Binance futures\'da bulunamadı.</div>';
            return;
        }
    } catch {
        container.innerHTML = '<div style="color:red;padding:20px;">Sembol Binance futures\'da bulunamadı.</div>';
        return;
    }

    const futuresSymbol = symbol.endsWith('PERP') ? symbol : symbol + 'PERP';

    new TradingView.widget({
        autosize: true,
        container_id: 'tv_chart_container',
        // Yalnızca Binance futures verisini göster
        symbol: 'BINANCE:' + futuresSymbol,
        interval: intervalMap[interval] || '1',
        timezone: 'Etc/UTC',
        theme: 'light',
        style: '1',
        locale: 'en',
        toolbar_bg: '#f1f3f6',
        hide_side_toolbar: false,
        withdateranges: true,
        allow_symbol_change: false,
        disabled_features: ['header_symbol_search', 'symbol_search', 'header_compare']
    });
}

loadChart();
</script>
</body>
</html>

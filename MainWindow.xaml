<Window x:Class="BinanceUsdtTicker.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        xmlns:local="clr-namespace:BinanceUsdtTicker"
        Title="Binance USDT Canlı Fiyatlar"
        Height="680" Width="1100" MinHeight="500" MinWidth="900"
        Background="{DynamicResource Surface}"
        Foreground="{DynamicResource OnSurface}">

	<!-- ========== RESOURCES ========== -->
        <Window.Resources>
                <local:SideToBrushConverter x:Key="SideToBrush"/>
                <!-- Şeffaf yıldız -->
                <Style x:Key="StarToggleStyle" TargetType="ToggleButton">
			<Setter Property="OverridesDefaultStyle" Value="True"/>
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="Padding" Value="0"/>
			<Setter Property="Focusable" Value="False"/>
			<Setter Property="FocusVisualStyle" Value="{x:Null}"/>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="ToggleButton">
						<ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
                </Style>

                <!-- Grafik butonu: arka plan temaya göre uyarlanır -->
                <Style x:Key="ChartButtonStyle" TargetType="Button">
                        <Setter Property="OverridesDefaultStyle" Value="True"/>
                        <!-- Hücre arka planını miras al -->
                        <Setter Property="Background"
                                Value="{Binding RelativeSource={RelativeSource AncestorType=DataGridCell}, Path=Background}"/>
                        <Setter Property="BorderBrush" Value="{DynamicResource SelectionBg}"/>
                        <Setter Property="BorderThickness" Value="1"/>
                        <Setter Property="Padding" Value="0"/>
                        <Setter Property="Focusable" Value="False"/>
                        <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
                        <Setter Property="Template">
                                <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                                <Border x:Name="Bd" Background="{TemplateBinding Background}"
                                                        BorderBrush="{TemplateBinding BorderBrush}"
                                                        BorderThickness="{TemplateBinding BorderThickness}"
                                                        CornerRadius="4">
                                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                                <Setter TargetName="Bd" Property="Background" Value="{DynamicResource RowHoverBg}"/>
                                                        </Trigger>
                                                        <Trigger Property="IsPressed" Value="True">
                                                                <Setter TargetName="Bd" Property="Background" Value="{DynamicResource RowHoverBg}"/>
                                                        </Trigger>
                                                </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                </Setter.Value>
                        </Setter>
                </Style>

                <!-- DataGrid başlığı -->
                <Style TargetType="DataGridColumnHeader">
			<Setter Property="Background"  Value="{DynamicResource HeaderBg}"/>
			<Setter Property="Foreground"  Value="{DynamicResource HeaderFg}"/>
			<Setter Property="BorderBrush" Value="{DynamicResource HeaderBorder}"/>
			<Setter Property="BorderThickness" Value="0,0,1,1"/>
			<Setter Property="FontWeight"  Value="SemiBold"/>
			<Setter Property="HorizontalContentAlignment" Value="Center"/>
			<Setter Property="Padding" Value="6,3"/>
			<Style.Triggers>
				<Trigger Property="IsMouseOver" Value="True">
					<Setter Property="Background" Value="{DynamicResource HeaderHoverBg}"/>
				</Trigger>
				<Trigger Property="IsPressed" Value="True">
					<Setter Property="Background" Value="{DynamicResource HeaderHoverBg}"/>
				</Trigger>
			</Style.Triggers>
		</Style>

		<!-- GridView başlığı -->
		<Style TargetType="{x:Type GridViewColumnHeader}">
			<Setter Property="Background"  Value="{DynamicResource HeaderBg}"/>
			<Setter Property="Foreground"  Value="{DynamicResource HeaderFg}"/>
			<Setter Property="BorderBrush" Value="{DynamicResource HeaderBorder}"/>
			<Setter Property="BorderThickness" Value="0,0,1,1"/>
			<Setter Property="FontWeight"  Value="SemiBold"/>
			<Setter Property="HorizontalContentAlignment" Value="Center"/>
			<Setter Property="Padding" Value="6,3"/>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="{x:Type GridViewColumnHeader}">
						<Border x:Name="Bd"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}">
							<ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                              VerticalAlignment="Center"
                                              Margin="{TemplateBinding Padding}"/>
						</Border>
						<ControlTemplate.Triggers>
							<Trigger Property="IsMouseOver" Value="True">
								<Setter TargetName="Bd" Property="Background" Value="{DynamicResource HeaderHoverBg}"/>
							</Trigger>
							<Trigger Property="IsPressed" Value="True">
								<Setter TargetName="Bd" Property="Background" Value="{DynamicResource HeaderHoverBg}"/>
							</Trigger>
						</ControlTemplate.Triggers>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>

                <!-- Button styles moved to global dictionary -->

                <!-- ToolBar TextBox -->
                <Style x:Key="{x:Static ToolBar.TextBoxStyleKey}"
                       TargetType="TextBox"
                       BasedOn="{StaticResource {x:Type TextBox}}">
                        <Setter Property="Background"      Value="{DynamicResource SurfaceAlt}"/>
                        <Setter Property="Foreground"      Value="{DynamicResource TbFg}"/>
                        <Setter Property="BorderBrush"     Value="{DynamicResource TbBorder}"/>
                        <Setter Property="BorderThickness" Value="1"/>
                        <Setter Property="Padding"         Value="6,2"/>
                        <Setter Property="MinWidth"        Value="220"/>
                        <Style.Triggers>
                                <Trigger Property="IsKeyboardFocusWithin" Value="True">
                                        <Setter Property="Background"  Value="{DynamicResource TbHover}"/>
                                        <Setter Property="BorderBrush" Value="{DynamicResource TbBorder}"/>
                                </Trigger>
                                <Trigger Property="IsEnabled" Value="False">
                                        <Setter Property="Opacity" Value="0.6"/>
                                </Trigger>
                        </Style.Triggers>
                </Style>
                <Style TargetType="ToolBar">
                        <Setter Property="Background" Value="{DynamicResource TbBg}"/>
                        <Setter Property="Foreground" Value="{DynamicResource TbFg}"/>
                </Style>

                <!-- ListView items -->
                <Style TargetType="ListViewItem">
                        <Setter Property="Background"  Value="{DynamicResource SurfaceAlt}"/>
                        <Setter Property="Foreground"  Value="{DynamicResource OnSurface}"/>
                        <Setter Property="BorderBrush" Value="{DynamicResource Divider}"/>
                        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                        <Setter Property="Focusable" Value="False"/>
                        <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="{DynamicResource RowHoverBg}"/>
                                </Trigger>
                                <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="{DynamicResource SelectionBg}"/>
                                        <Setter Property="Foreground" Value="{DynamicResource SelectionFg}"/>
                                </Trigger>
                        </Style.Triggers>
                </Style>

		<!-- DataGrid hücre -->
                <Style TargetType="DataGridCell">
                        <Setter Property="BorderBrush" Value="{DynamicResource Divider}"/>
                        <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="{DynamicResource SelectionBg}"/>
                                        <Setter Property="Foreground" Value="{DynamicResource SelectionFg}"/>
                                </Trigger>
                        </Style.Triggers>
                </Style>

                <Style TargetType="DataGridRowHeader">
                        <Setter Property="Background"  Value="{DynamicResource SurfaceAlt}"/>
                        <Setter Property="Foreground"  Value="{DynamicResource OnSurface}"/>
                        <Setter Property="BorderBrush" Value="{DynamicResource Divider}"/>
                </Style>

		<!-- Scrollbar -->
                <Style x:Key="App.ScrollThumbStyle" TargetType="Thumb">
                        <Setter Property="Background"   Value="{DynamicResource TbBg}"/>
                        <Setter Property="BorderBrush"  Value="{DynamicResource Divider}"/>
                        <Setter Property="BorderThickness" Value="1"/>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="Thumb">
						<Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="3"/>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
			<Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="{DynamicResource TbHover}"/>
                                </Trigger>
                                <Trigger Property="IsDragging" Value="True">
                                        <Setter Property="Background" Value="{DynamicResource TbPressed}"/>
                                </Trigger>
			</Style.Triggers>
		</Style>
                <Style TargetType="ScrollBar">
                        <Setter Property="Background" Value="{DynamicResource SurfaceAlt}"/>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="ScrollBar">
						<Grid Background="{TemplateBinding Background}">


							<Track x:Name="PART_Track" Orientation="{TemplateBinding Orientation}">
								<Track.DecreaseRepeatButton>
									<RepeatButton Opacity="0" IsHitTestVisible="False"/>
								</Track.DecreaseRepeatButton>
								<Track.IncreaseRepeatButton>
									<RepeatButton Opacity="0" IsHitTestVisible="False"/>
								</Track.IncreaseRepeatButton>
								<Track.Thumb>
									<Thumb Style="{StaticResource App.ScrollThumbStyle}"/>
								</Track.Thumb>
							</Track>
						</Grid>
						<ControlTemplate.Triggers>
							<Trigger Property="Orientation" Value="Vertical">
								<Setter TargetName="PART_Track" Property="IsDirectionReversed" Value="True"/>
							</Trigger>
							<Trigger Property="Orientation" Value="Horizontal">
								<Setter TargetName="PART_Track" Property="IsDirectionReversed" Value="False"/>
							</Trigger>
						</ControlTemplate.Triggers>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
			<Style.Triggers>
				<Trigger Property="Orientation" Value="Vertical">
					<Setter Property="Width"  Value="12"/>
					<Setter Property="Height" Value="{x:Static sys:Double.NaN}"/>
				</Trigger>
				<Trigger Property="Orientation" Value="Horizontal">
					<Setter Property="Height" Value="12"/>
					<Setter Property="Width"  Value="{x:Static sys:Double.NaN}"/>
				</Trigger>
			</Style.Triggers>
		</Style>

		<!-- Toolbar grup kutusu -->
                <Style x:Key="ToolbarGroup" TargetType="Border">
                        <Setter Property="CornerRadius" Value="6"/>
                        <Setter Property="BorderBrush" Value="{DynamicResource Divider}"/>
                        <Setter Property="BorderThickness" Value="1"/>
                        <Setter Property="Background" Value="{DynamicResource SurfaceAlt}"/>
                        <Setter Property="Padding" Value="6,4"/>
                        <Setter Property="Margin" Value="8,0,0,0"/>
                </Style>
	</Window.Resources>

        <DockPanel LastChildFill="True">

                <Border DockPanel.Dock="Top" Background="{DynamicResource TbBg}" BorderBrush="{DynamicResource TbBorder}" BorderThickness="0,0,0,1">
                        <ToolBarTray Panel.ZIndex="10" IsLocked="True" HorizontalAlignment="Stretch" Background="{DynamicResource TbBg}">
                                <ToolBar Band="0" BandIndex="0" ToolBarTray.IsLocked="True" HorizontalAlignment="Stretch">
                                <ToolBar.Resources>
                                        <!-- Neutralize any app-wide ScrollViewer ControlTemplate that may cause circular template issues in ToolBar/TextBox -->
                                        <Style TargetType="{x:Type ScrollViewer}" BasedOn="{x:Null}" />

					<!-- Also force TextBox in ToolBar to use a safe template whose PART_ContentHost ScrollViewer does NOT pick implicit styles -->
                                        <Style TargetType="{x:Type TextBox}">
                                                <Setter Property="BorderBrush" Value="{DynamicResource TbBorder}"/>
                                                <Setter Property="Background" Value="{DynamicResource SurfaceAlt}"/>
                                                <Setter Property="Foreground" Value="{DynamicResource TbFg}"/>
						<Setter Property="Template">
							<Setter.Value>
								<ControlTemplate TargetType="{x:Type TextBox}">
									<Border Background="{TemplateBinding Background}"
											BorderBrush="{TemplateBinding BorderBrush}"
											BorderThickness="1" Padding="2">
										<ScrollViewer x:Name="PART_ContentHost" Style="{x:Null}"/>
									</Border>
								</ControlTemplate>
							</Setter.Value>
						</Setter>
					</Style>
                                </ToolBar.Resources>

                                <TextBox x:Name="SearchBox" Width="220"
                                         ToolTip="Sembol ara..."
                                         ToolBar.OverflowMode="Never"
                                         BorderThickness="2"
                                         BorderBrush="{DynamicResource TbChecked}"
                                         Margin="0,0,12,0"
                                         TextChanged="SearchBox_TextChanged"/>

                                <Separator/>
                                <RadioButton x:Name="RbAll" ToolBar.OverflowMode="Never"
                                                         Style="{StaticResource ToolbarRadioStyle}"
                                                         Tag="All" Content="Tümü" GroupName="Mode" IsChecked="True"
                                                         Checked="FilterModeChanged" Margin="6,0"/>
				<RadioButton x:Name="RbPos" ToolBar.OverflowMode="Never"
							 Style="{StaticResource ToolbarRadioStyle}"
							 Tag="Positive" Content="Yükselen" GroupName="Mode"
							 Checked="FilterModeChanged" Margin="6,0"/>
				<RadioButton x:Name="RbNeg" ToolBar.OverflowMode="Never"
							 Style="{StaticResource ToolbarRadioStyle}"
							 Tag="Negative" Content="Düşen" GroupName="Mode"
							 Checked="FilterModeChanged" Margin="6,0"/>

				<Separator/>

				<Button Content="% ≥ 3" ToolBar.OverflowMode="Never"
						Style="{StaticResource ToolbarButtonStyle}"
						Click="Chip_Pos3_Click" Margin="6,0"/>
				<Button Content="% ≤ −3" ToolBar.OverflowMode="Never"
						Style="{StaticResource ToolbarButtonStyle}"
						Click="Chip_Neg3_Click" Margin="6,0"/>
				<Button Content="Temizle" ToolBar.OverflowMode="Never"
						Style="{StaticResource ToolbarButtonStyle}"
						Click="Chip_Clear_Click" Margin="6,0"/>

				<Separator/>

                                <Button Content="Snapshot Al" ToolBar.OverflowMode="Never"
                                                Style="{StaticResource ToolbarButtonStyle}"
                                                Click="RefreshSymbols_Click" Margin="6,0"/>

				<Separator/>

                                <Button Content="Alarm Ekle" ToolBar.OverflowMode="Never"
                                                Style="{StaticResource ToolbarButtonStyle}"
                                                Click="AddAlert_Click" Margin="6,0"/>
                                <Button Content="Alarmları Yönet" ToolBar.OverflowMode="Never"
                                                Style="{StaticResource ToolbarButtonStyle}"
                                                Click="ManageAlerts_Click" Margin="6,0"/>
                                <Separator/>
                                <Separator DockPanel.Dock="Right"/>
                                <Button x:Name="SettingsButton" ToolBar.OverflowMode="Never"
                                        DockPanel.Dock="Right" Style="{StaticResource ToolbarButtonStyle}"
                                        FontSize="16" Width="90" Click="SettingsButton_Click">
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                <TextBlock Text="⚙" Margin="0,0,4,0"/>
                                                <TextBlock Text="Ayarlar" FontWeight="Bold"/>
                                        </StackPanel>
                                </Button>
                                </ToolBar>
                        </ToolBarTray>
                </Border>


		<!-- STATUS BAR -->
		<StatusBar DockPanel.Dock="Bottom">
			<StatusBarItem HorizontalAlignment="Left" Margin="0,0,12,0">
				<StackPanel Orientation="Horizontal" VerticalAlignment="Center">
					<TextBlock x:Name="SnapshotInfoText" Text="Snapshot alınmadı"/>
					<Rectangle Width="12" Fill="Transparent"/>
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                <Border Width="14" Height="14" CornerRadius="3" Background="{DynamicResource Up1Bg}"
                                BorderBrush="#66000000" BorderThickness="1" Margin="0,0,6,0"/>
                                                <TextBlock Text="%1 – %3" VerticalAlignment="Center"/>
                                        </StackPanel>
                                        <Rectangle Width="12" Fill="Transparent"/>
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                <Border Width="14" Height="14" CornerRadius="3" Background="{DynamicResource Up3Bg}"
                                BorderBrush="#66000000" BorderThickness="1" Margin="0,0,6,0"/>
                                                <TextBlock Text="≥%3" Foreground="{DynamicResource Up3Fg}" VerticalAlignment="Center"
                                   Background="#22000000" Padding="0,0,2,0"/>
                                        </StackPanel>
                                        <Rectangle Width="12" Fill="Transparent"/>
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                <Border Width="14" Height="14" CornerRadius="3" Background="{DynamicResource Down1Bg}"
                                BorderBrush="#66000000" BorderThickness="1" Margin="0,0,6,0"/>
                                                <TextBlock Text="-%1 – -%3" VerticalAlignment="Center"/>
                                        </StackPanel>
                                        <Rectangle Width="12" Fill="Transparent"/>
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                <Border Width="14" Height="14" CornerRadius="3" Background="{DynamicResource Down3Bg}"
                                BorderBrush="#66000000" BorderThickness="1" Margin="0,0,6,0"/>
                                                <TextBlock Text="≤-%3" Foreground="{DynamicResource Down3Fg}" VerticalAlignment="Center"
                                   Background="#22000000" Padding="0,0,2,0"/>
                                        </StackPanel>
                </StackPanel>
            </StatusBarItem>

            <StatusBarItem HorizontalAlignment="Right" Margin="0,0,12,0">
                <TextBlock x:Name="WsStateText"/>
            </StatusBarItem>

            <StatusBarItem HorizontalAlignment="Right">
                <TextBlock x:Name="LastUpdateText"/>
            </StatusBarItem>
        </StatusBar>

                <!-- ANA GÖVDE -->
		<Grid Grid.Row="1">
			<Grid.RowDefinitions>

				<RowDefinition Height="*"/>
				<RowDefinition Height="Auto"/>

			</Grid.RowDefinitions>

                        <Grid.ColumnDefinitions>
                                <!-- Futures panel expanded for better usability -->
                                <ColumnDefinition Width="300"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="260"/>
                        </Grid.ColumnDefinitions>

                        <!-- FİYAT TABLOSU -->
                        <DataGrid x:Name="Grid"
                      Grid.Row="0" Grid.Column="1"
                      AutoGenerateColumns="False"
                      EnableRowVirtualization="True"
                      IsReadOnly="True"
                      CanUserSortColumns="True"
                      CanUserReorderColumns="True"
                      HeadersVisibility="Column"
                      Background="{DynamicResource SurfaceAlt}"
                      Foreground="{DynamicResource OnSurface}"
                      GridLinesVisibility="None"
                      ScrollViewer.HorizontalScrollBarVisibility="Disabled" Margin="0,0,8,0"
                      SelectionChanged="Grid_SelectionChanged">

				<!-- Satır stili -->
                                <DataGrid.RowStyle>
                                        <Style TargetType="DataGridRow" BasedOn="{StaticResource {x:Type DataGridRow}}">
                                                <Style.Triggers>
                                                        <!-- Renklendirme -->
                                                       <DataTrigger Binding="{Binding IsMove3Plus}" Value="True">
                                                               <Setter Property="Background" Value="{DynamicResource Up3Bg}"/>
                                                               <Setter Property="Foreground" Value="{DynamicResource Up3Fg}"/>
                                                       </DataTrigger>
                                                       <DataTrigger Binding="{Binding IsMove1Plus}" Value="True">
                                                               <Setter Property="Background" Value="{DynamicResource Up1Bg}"/>
                                                               <Setter Property="Foreground" Value="{DynamicResource Up1Fg}"/>
                                                       </DataTrigger>
                                                       <DataTrigger Binding="{Binding IsMoveMinus3}" Value="True">
                                                               <Setter Property="Background" Value="{DynamicResource Down3Bg}"/>
                                                               <Setter Property="Foreground" Value="{DynamicResource Down3Fg}"/>
                                                       </DataTrigger>
                                                       <DataTrigger Binding="{Binding IsMoveMinus1}" Value="True">
                                                               <Setter Property="Background" Value="{DynamicResource Down1Bg}"/>
                                                               <Setter Property="Foreground" Value="{DynamicResource Down1Fg}"/>
                                                       </DataTrigger>
							<DataTrigger Binding="{Binding IsFavorite}" Value="True">
								<Setter Property="FontWeight" Value="Bold"/>
							</DataTrigger>
						</Style.Triggers>
					</Style>
                                </DataGrid.RowStyle>

                                <!-- Hücre stili -->
                                <DataGrid.CellStyle>
                                        <Style TargetType="DataGridCell" BasedOn="{StaticResource {x:Type DataGridCell}}">
                                                <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsMove3Plus}" Value="True">
                                                                <Setter Property="Foreground" Value="{DynamicResource Up3Fg}"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding IsMove1Plus}" Value="True">
                                                                <Setter Property="Foreground" Value="{DynamicResource Up1Fg}"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding IsMoveMinus3}" Value="True">
                                                                <Setter Property="Foreground" Value="{DynamicResource Down3Fg}"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding IsMoveMinus1}" Value="True">
                                                                <Setter Property="Foreground" Value="{DynamicResource Down1Fg}"/>
                                                        </DataTrigger>
                                                </Style.Triggers>
                                        </Style>
                                </DataGrid.CellStyle>

                                <!-- Kolonlar -->
                                <DataGrid.Columns>

					<!-- 0) ⭐ Favori -->
					<DataGridTemplateColumn x:Name="ColStar"
                                            Header="★" Width="32"
                                            IsReadOnly="True" CanUserSort="False">
						<DataGridTemplateColumn.CellTemplate>
							<DataTemplate>
								<ToggleButton Style="{StaticResource StarToggleStyle}"
                                              IsChecked="{Binding IsFavorite, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                              Click="FavoriteToggle_Click"
                                              Cursor="Hand">
									<TextBlock x:Name="StarIcon" Text="☆" FontSize="16" Foreground="#AAAAAA"/>
								</ToggleButton>
								<DataTemplate.Triggers>
									<DataTrigger Binding="{Binding IsFavorite}" Value="True">
										<Setter TargetName="StarIcon" Property="TextBlock.Text" Value="★"/>
										<Setter TargetName="StarIcon" Property="TextBlock.Foreground" Value="Gold"/>
									</DataTrigger>
								</DataTemplate.Triggers>
							</DataTemplate>
						</DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>

                                        <!-- 1) Grafik -->
                                        <DataGridTemplateColumn x:Name="ColChart"
                                            Header="Grafik" Width="32"
                                            IsReadOnly="True" CanUserSort="False">
                                                <DataGridTemplateColumn.CellTemplate>
                                                        <DataTemplate>
                                                                <Button Style="{StaticResource ChartButtonStyle}"
                                            Click="ChartButton_Click" Cursor="Hand">
                                                                        <TextBlock Text="📈" FontSize="16" Foreground="{DynamicResource SelectionBg}"/>
                                                                </Button>
                                                        </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>

                                        <!-- 2) Sembol -->
                                        <DataGridTemplateColumn x:Name="ColSymbol"
                                            Header="Sembol"
                                            Width="1.2*" MinWidth="100">
						<DataGridTemplateColumn.CellTemplate>
							<DataTemplate>
								<TextBlock>
									<Run Text="{Binding BaseSymbol, Mode=OneWay}"/>
									<Run Text="/USDT" Foreground="Gray"/>
								</TextBlock>
							</DataTemplate>
						</DataGridTemplateColumn.CellTemplate>
					</DataGridTemplateColumn>

					<!-- Başlangıç -->
					<DataGridTextColumn x:Name="ColBaseline" Header="Başlangıç Fiyatı"
                                        Width="1*" MinWidth="90"
                                        Binding="{Binding BaselinePrice, StringFormat={}{0:#,0.########}, TargetNullValue=-}">
						<DataGridTextColumn.ElementStyle>
							<Style TargetType="TextBlock">
								<Setter Property="TextAlignment" Value="Right"/>
							</Style>
						</DataGridTextColumn.ElementStyle>
					</DataGridTextColumn>

					<!-- Fiyat -->
					<DataGridTextColumn x:Name="ColPrice" Header="Fiyat"
                                        Width="1*" MinWidth="90"
                                        Binding="{Binding Price, StringFormat={}{0:#,0.########}}">
                                                <DataGridTextColumn.ElementStyle>
                                                        <Style TargetType="TextBlock">
                                                                <Setter Property="TextAlignment" Value="Right"/>
                                                        </Style>
                                                </DataGridTextColumn.ElementStyle>
                                        </DataGridTextColumn>

                                       <!-- Anlık Değişim -->
                                      <DataGridTemplateColumn x:Name="ColChSnap" Header="Anlık Değişim"
                                      Width="0.9*" MinWidth="80" SortMemberPath="ChangeSinceStartPercent" IsReadOnly="True">
                                               <DataGridTemplateColumn.CellTemplate>
                                                       <DataTemplate>
                                                               <Border x:Name="border">
                                                                       <TextBlock x:Name="tb" TextAlignment="Right">
                                                                               <Run x:Name="ArrowRun"/>
                                                                               <Run Text="{Binding ChangeSinceStartPercent, StringFormat=N2, Mode=OneWay}"/>
                                                                       </TextBlock>
                                                               </Border>
                                                               <DataTemplate.Triggers>
                                                                       <DataTrigger Binding="{Binding IsMove3Plus}" Value="True">
                                                                               <Setter TargetName="border" Property="Background" Value="{DynamicResource Up3Bg}"/>
                                                                               <Setter TargetName="tb" Property="Foreground" Value="{DynamicResource Up3Fg}"/>
                                                                               <Setter TargetName="tb" Property="FontWeight" Value="Bold"/>
                                                                               <Setter TargetName="ArrowRun" Property="Text" Value="▲ "/>
                                                                       </DataTrigger>
                                                                       <DataTrigger Binding="{Binding IsMove1Plus}" Value="True">
                                                                               <Setter TargetName="border" Property="Background" Value="{DynamicResource Up1Bg}"/>
                                                                               <Setter TargetName="tb" Property="Foreground" Value="{DynamicResource Up1Fg}"/>
                                                                               <Setter TargetName="tb" Property="FontWeight" Value="Bold"/>
                                                                               <Setter TargetName="ArrowRun" Property="Text" Value="▲ "/>
                                                                       </DataTrigger>
                                                                       <DataTrigger Binding="{Binding IsMoveMinus3}" Value="True">
                                                                               <Setter TargetName="border" Property="Background" Value="{DynamicResource Down3Bg}"/>
                                                                               <Setter TargetName="tb" Property="Foreground" Value="{DynamicResource Down3Fg}"/>
                                                                               <Setter TargetName="tb" Property="FontWeight" Value="Bold"/>
                                                                               <Setter TargetName="ArrowRun" Property="Text" Value="▼ "/>
                                                                       </DataTrigger>
                                                                       <DataTrigger Binding="{Binding IsMoveMinus1}" Value="True">
                                                                               <Setter TargetName="border" Property="Background" Value="{DynamicResource Down1Bg}"/>
                                                                               <Setter TargetName="tb" Property="Foreground" Value="{DynamicResource Down1Fg}"/>
                                                                               <Setter TargetName="tb" Property="FontWeight" Value="Bold"/>
                                                                               <Setter TargetName="ArrowRun" Property="Text" Value="▼ "/>
                                                                       </DataTrigger>
                                                               </DataTemplate.Triggers>
                                                       </DataTemplate>
                                               </DataGridTemplateColumn.CellTemplate>
                                       </DataGridTemplateColumn>

					<!-- %24s -->
					<DataGridTextColumn x:Name="ColCh24" Header="% 24s"
                                        Width="0.8*" MinWidth="70"
                                        Binding="{Binding ChangePercent, StringFormat=N2}">
						<DataGridTextColumn.ElementStyle>
							<Style TargetType="TextBlock">
								<Setter Property="TextAlignment" Value="Right"/>
							</Style>
						</DataGridTextColumn.ElementStyle>
					</DataGridTextColumn>

					<!-- Detay kolonları -->
					<DataGridTextColumn x:Name="ColOpen" Header="Açılış"
                                        Visibility="Visible"
                                        Width="0.8*" MinWidth="70"
                                        Binding="{Binding Open, StringFormat={}{0:#,0.########}}">
						<DataGridTextColumn.ElementStyle>
							<Style TargetType="TextBlock">
								<Setter Property="TextAlignment" Value="Right"/>
								<Setter Property="TextTrimming" Value="CharacterEllipsis"/>
							</Style>
						</DataGridTextColumn.ElementStyle>
					</DataGridTextColumn>
					<DataGridTextColumn x:Name="ColHigh" Header="Yüksek"
                                        Visibility="Visible"
                                        Width="0.8*" MinWidth="70"
                                        Binding="{Binding High, StringFormat={}{0:#,0.########}}">
						<DataGridTextColumn.ElementStyle>
							<Style TargetType="TextBlock">
								<Setter Property="TextAlignment" Value="Right"/>
								<Setter Property="TextTrimming" Value="CharacterEllipsis"/>
							</Style>
						</DataGridTextColumn.ElementStyle>
					</DataGridTextColumn>
					<DataGridTextColumn x:Name="ColLow" Header="Düşük"
                                        Visibility="Visible"
                                        Width="0.8*" MinWidth="70"
                                        Binding="{Binding Low, StringFormat={}{0:#,0.########}}">
						<DataGridTextColumn.ElementStyle>
							<Style TargetType="TextBlock">
								<Setter Property="TextAlignment" Value="Right"/>
								<Setter Property="TextTrimming" Value="CharacterEllipsis"/>
							</Style>
						</DataGridTextColumn.ElementStyle>
					</DataGridTextColumn>

					<!-- Hacim -->
					<DataGridTextColumn x:Name="ColVol" Header="Hacim"
                                        Width="1.3*" MinWidth="110"
                                        Binding="{Binding Volume, StringFormat={}{0:#,0.##}}">
						<DataGridTextColumn.ElementStyle>
							<Style TargetType="TextBlock">
								<Setter Property="TextAlignment" Value="Right"/>
								<Setter Property="TextTrimming" Value="CharacterEllipsis"/>
							</Style>
						</DataGridTextColumn.ElementStyle>
					</DataGridTextColumn>

					<!-- Son -->
					<DataGridTextColumn x:Name="ColLast" Header="Son"
                                        Width="0.8*" MinWidth="80"
                                        Binding="{Binding LastUpdateLocal}"/>
				</DataGrid.Columns>
			</DataGrid>

                        <!-- FUTURES INFO -->
                        <GroupBox Grid.Row="0" Grid.Column="0" Header="Futures" Margin="0,0,8,0"
                      Background="{DynamicResource SurfaceAlt}" Foreground="{DynamicResource OnSurface}"
                      VerticalAlignment="Stretch" BorderBrush="{DynamicResource Divider}">
                                <StackPanel Margin="4">
                                        <TextBlock x:Name="FuturesSymbolText" FontWeight="Bold" Margin="0,0,0,8"/>
                                        <Grid Margin="0,0,0,8">
                                                <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <ToggleButton x:Name="CrossMarginButton" Content="Cross" Grid.Column="0" Margin="0,0,4,0" Click="MarginMode_Click" Style="{StaticResource ToolbarToggleButtonStyle}"/>
                                                <ToggleButton x:Name="IsolatedMarginButton" Content="Isolated" Grid.Column="1" Margin="4,0,0,0" IsChecked="True" Click="MarginMode_Click" Style="{StaticResource ToolbarToggleButtonStyle}"/>
                                        </Grid>
                                        <StackPanel Margin="0,0,0,8">
                                                <Grid Margin="0,0,0,4">
                                                        <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="Auto"/>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <Button x:Name="LevMinusButton" Content="-" Width="30" Click="LevMinusButton_Click"/>
                                                        <TextBlock x:Name="LeverageValueText" Grid.Column="1" TextAlignment="Center" VerticalAlignment="Center" Text="1x"/>
                                                        <Button x:Name="LevPlusButton" Grid.Column="2" Content="+" Width="30" Click="LevPlusButton_Click"/>
                                                </Grid>
                                               <Slider x:Name="LeverageSlider" Minimum="1" Maximum="150" TickPlacement="BottomRight" IsSnapToTickEnabled="False" Value="1" ValueChanged="LeverageSlider_ValueChanged" Ticks="1,30,60,90,120,150"/>
                                                <ItemsControl x:Name="LeverageTickLabels" Margin="0,4,0,0" AlternationCount="100">
                                                        <ItemsControl.ItemsPanel>
                                                                <ItemsPanelTemplate>
                                                                        <Grid/>
                                                                </ItemsPanelTemplate>
                                                        </ItemsControl.ItemsPanel>
                                                        <ItemsControl.ItemContainerStyle>
                                                                <Style TargetType="ContentPresenter">
                                                                        <Setter Property="Grid.Column" Value="{Binding RelativeSource={RelativeSource Self}, Path=(ItemsControl.AlternationIndex)}"/>
                                                                </Style>
                                                        </ItemsControl.ItemContainerStyle>
                                                        <ItemsControl.ItemTemplate>
                                                                <DataTemplate>
                                                                        <TextBlock Text="{Binding StringFormat={}{0}x}" HorizontalAlignment="Center"/>
                                                                </DataTemplate>
                                                        </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                        </StackPanel>
                                        <TextBlock Text="Miktar" Margin="0,0,0,4"/>
                                        <Slider x:Name="SizeSlider" Minimum="0" Maximum="100" ValueChanged="SizeSlider_ValueChanged"/>
                                        <TextBlock x:Name="QuantityValueText" Margin="0,4,0,0"/>
                                        <TextBlock Text="Fiyat" Margin="0,8,0,0"/>
                                        <TextBlock x:Name="CurrentPriceText"/>
                                        <TextBlock Text="Tutar (USDT)" Margin="0,8,0,0"/>
                                        <TextBlock x:Name="TotalUsdtText"/>
                                </StackPanel>
                        </GroupBox>

                        <!-- TOP MOVERS -->
                        <GroupBox Grid.Row="0" Grid.Column="2" Header="Top Movers" Margin="0,0,8,0"
                      Background="{DynamicResource SurfaceAlt}" Foreground="{DynamicResource OnSurface}"
                      VerticalAlignment="Stretch" BorderBrush="{DynamicResource Divider}">
				<Grid>
                                        <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="*"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="*"/>
                                        </Grid.RowDefinitions>

                                        <ToggleButton Grid.Row="0" x:Name="btnSnapshot"
                                                      Style="{StaticResource ToolbarToggleButtonStyle}"
                                                      Content="Top Movers: Snapshot"
                                                      Checked="btnSnapshot_Checked"
                                                      Unchecked="btnSnapshot_Unchecked"
                                                      Margin="0,0,0,4" HorizontalAlignment="Center"/>

                                        <TextBlock Grid.Row="1" Text="Yükselenler" FontWeight="Bold" Margin="0,0,0,4"/>
                                        <ListView Grid.Row="2" x:Name="TopGainersList"
                             Background="{DynamicResource SurfaceAlt}" Foreground="{DynamicResource OnSurface}"
                             ScrollViewer.VerticalScrollBarVisibility="Auto"
                             VirtualizingStackPanel.IsVirtualizing="True"
                             VirtualizingStackPanel.VirtualizationMode="Recycling">
                                               <ListView.ItemContainerStyle>
                                                       <Style TargetType="ListViewItem" BasedOn="{StaticResource {x:Type ListViewItem}}">
                                                               <Style.Triggers>
                                                                       <!-- 3%+ moves: dark green with white text -->
                                                                       <DataTrigger Binding="{Binding IsMove3Plus}" Value="True">
                                                                               <Setter Property="Background" Value="{DynamicResource Up3Bg}"/>
                                                                               <Setter Property="Foreground" Value="{DynamicResource Up3Fg}"/>
                                                                               <Setter Property="TextElement.Foreground" Value="{DynamicResource Up3Fg}"/>
                                                                       </DataTrigger>
                                                                       <!-- 1-3% moves: light green with black text -->
                                                                       <DataTrigger Binding="{Binding IsMove1Plus}" Value="True">
                                                                               <Setter Property="Background" Value="{DynamicResource Up1Bg}"/>
                                                                               <Setter Property="Foreground" Value="{DynamicResource Up1Fg}"/>
                                                                               <Setter Property="TextElement.Foreground" Value="{DynamicResource Up1Fg}"/>
                                                                       </DataTrigger>
                                                                       <!-- Hover: highlight row -->
                                                                       <Trigger Property="IsMouseOver" Value="True">
                                                                               <Setter Property="Background" Value="{DynamicResource RowHoverBg}"/>
                                                                               <Setter Property="Foreground" Value="{DynamicResource OnSurface}"/>
                                                                               <Setter Property="TextElement.Foreground" Value="{DynamicResource OnSurface}"/>
                                                                       </Trigger>
                                                               </Style.Triggers>
                                                       </Style>
                                               </ListView.ItemContainerStyle>
                                                <ListView.View>
                                                        <GridView>
                                                                <GridViewColumn Header="Sembol" Width="80">
                                                                        <GridViewColumn.CellTemplate>
                                                                                <DataTemplate>
                                                                                        <TextBlock>
                                                                                                <Run Text="{Binding BaseSymbol, Mode=OneWay}"/>
                                                                                                <Run Text="/USDT" Foreground="Gray"/>
                                                                                        </TextBlock>
                                                                                </DataTemplate>
                                                                        </GridViewColumn.CellTemplate>
                                                                </GridViewColumn>
                                                                <GridViewColumn Header="%" Width="70">
                                                                        <GridViewColumn.CellTemplate>
                                                                                <DataTemplate>
                                                                                        <TextBlock Text="{Binding Metric, StringFormat={}{0:N2}%}"
                                               TextAlignment="Right" FontFamily="Consolas"/>
                                                                                </DataTemplate>
                                                                        </GridViewColumn.CellTemplate>
                                                                </GridViewColumn>
                                                        </GridView>
                                                </ListView.View>
                                        </ListView>

					<TextBlock Grid.Row="3" Text="Düşenler" FontWeight="Bold" Margin="0,6,0,4"/>
                                        <ListView Grid.Row="4" x:Name="TopLosersList"
                             Background="{DynamicResource SurfaceAlt}" Foreground="{DynamicResource OnSurface}"
                             ScrollViewer.VerticalScrollBarVisibility="Auto"
                             VirtualizingStackPanel.IsVirtualizing="True"
                             VirtualizingStackPanel.VirtualizationMode="Recycling">
                                               <ListView.ItemContainerStyle>
                                                       <Style TargetType="ListViewItem" BasedOn="{StaticResource {x:Type ListViewItem}}">
                                                               <Style.Triggers>
                                                                       <!-- -3% or worse: dark red with white text -->
                                                                       <DataTrigger Binding="{Binding IsMoveMinus3}" Value="True">
                                                                               <Setter Property="Background" Value="{DynamicResource Down3Bg}"/>
                                                                               <Setter Property="Foreground" Value="{DynamicResource Down3Fg}"/>
                                                                               <Setter Property="TextElement.Foreground" Value="{DynamicResource Down3Fg}"/>
                                                                       </DataTrigger>
                                                                       <!-- -1% to -3%: light red with black text -->
                                                                       <DataTrigger Binding="{Binding IsMoveMinus1}" Value="True">
                                                                               <Setter Property="Background" Value="{DynamicResource Down1Bg}"/>
                                                                               <Setter Property="Foreground" Value="{DynamicResource Down1Fg}"/>
                                                                               <Setter Property="TextElement.Foreground" Value="{DynamicResource Down1Fg}"/>
                                                                       </DataTrigger>
                                                                       <!-- Hover: highlight row -->
                                                                       <Trigger Property="IsMouseOver" Value="True">
                                                                               <Setter Property="Background" Value="{DynamicResource RowHoverBg}"/>
                                                                               <Setter Property="Foreground" Value="{DynamicResource OnSurface}"/>
                                                                               <Setter Property="TextElement.Foreground" Value="{DynamicResource OnSurface}"/>
                                                                       </Trigger>
                                                               </Style.Triggers>
                                                       </Style>
                                               </ListView.ItemContainerStyle>
                                                <ListView.View>
                                                        <GridView>
                                                                <GridViewColumn Header="Sembol" Width="80">
                                                                        <GridViewColumn.CellTemplate>
                                                                                <DataTemplate>
                                                                                        <TextBlock>
                                                                                                <Run Text="{Binding BaseSymbol, Mode=OneWay}"/>
                                                                                                <Run Text="/USDT" Foreground="Gray"/>
                                                                                        </TextBlock>
                                                                                </DataTemplate>
                                                                        </GridViewColumn.CellTemplate>
                                                                </GridViewColumn>
                                                                <GridViewColumn Header="%" Width="70">
                                                                        <GridViewColumn.CellTemplate>
                                                                                <DataTemplate>
                                                                                        <TextBlock Text="{Binding Metric, StringFormat={}{0:N2}%}"
                                               TextAlignment="Right" FontFamily="Consolas"/>
                                                                                </DataTemplate>
                                                                        </GridViewColumn.CellTemplate>
                                                                </GridViewColumn>
                                                        </GridView>
                                                </ListView.View>
                                        </ListView>
				</Grid>
			</GroupBox>

                        <!-- ALARM VE CÜZDAN -->
                        <Grid Grid.Row="1" Grid.ColumnSpan="3">
                                  <Grid.ColumnDefinitions>
                                          <ColumnDefinition Width="3*"/>
                                          <ColumnDefinition Width="*"/>
                                          <ColumnDefinition Width="*"/>
                                  </Grid.ColumnDefinitions>

                                <!-- EMIR VE POZISYONLAR -->
                                <Expander Grid.Column="0" Header="Emirler" IsExpanded="True" Padding="6,4">
                                        <TabControl Margin="0,6,0,0">
                                                <TabItem Header="Açık Pozisyonlar">
                                                        <ListView x:Name="PositionsList">
                                                                <ListView.View>
                                                                        <GridView>
                                                                                <GridViewColumn Header="Sembol" Width="90">
                                                                                        <GridViewColumn.CellTemplate>
                                                                                                <DataTemplate>
                                                                                                        <TextBlock>
                                                                                                                <Run Text="{Binding BaseSymbol, Mode=OneWay}"/>
                                                                                                                <Run Text="/USDT" Foreground="Gray"/>
                                                                                                        </TextBlock>
                                                                                                </DataTemplate>
                                                                                        </GridViewColumn.CellTemplate>
                                                                                </GridViewColumn>
                                                                                <GridViewColumn Header="Adet" Width="80">
                                                                                        <GridViewColumn.CellTemplate>
                                                                                                <DataTemplate>
                                                                                                        <TextBlock Text="{Binding PositionAmt, StringFormat={}{0:#,0.####}}" TextAlignment="Right"/>
                                                                                                </DataTemplate>
                                                                                        </GridViewColumn.CellTemplate>
                                                                                </GridViewColumn>
                                                                                <GridViewColumn Header="Giriş" Width="80">
                                                                                        <GridViewColumn.CellTemplate>
                                                                                                <DataTemplate>
                                                                                                        <TextBlock Text="{Binding EntryPrice, StringFormat={}{0:#,0.####}}" TextAlignment="Right"/>
                                                                                                </DataTemplate>
                                                                                        </GridViewColumn.CellTemplate>
                                                                                </GridViewColumn>
                                                                                <GridViewColumn Header="PNL" Width="80">
                                                                                        <GridViewColumn.CellTemplate>
                                                                                                <DataTemplate>
                                                                                                        <TextBlock Text="{Binding UnrealizedPnl, StringFormat={}{0:#,0.##}}"
                                                       TextAlignment="Right"
                                                       Foreground="{Binding PnlBrush}"/>
                                                                                                </DataTemplate>
                                                                                        </GridViewColumn.CellTemplate>
                                                                                </GridViewColumn>
                                                                                <GridViewColumn Header="x" Width="40" DisplayMemberBinding="{Binding Leverage}"/>
                                                                                <GridViewColumn Header="Marjin" Width="70" DisplayMemberBinding="{Binding MarginType}"/>
                                                                        </GridView>
                                                                </ListView.View>
                                                        </ListView>
                                                </TabItem>
                                                <TabItem Header="Açık Emirler">
                                                        <ListView x:Name="OrdersList">
                                                                <ListView.View>
                                                                        <GridView>
                                                                                <GridViewColumn Header="Sembol" Width="90">
                                                                                        <GridViewColumn.CellTemplate>
                                                                                                <DataTemplate>
                                                                                                        <TextBlock>
                                                                                                                <Run Text="{Binding BaseSymbol, Mode=OneWay}"/>
                                                                                                                <Run Text="/USDT" Foreground="Gray"/>
                                                                                                        </TextBlock>
                                                                                                </DataTemplate>
                                                                                        </GridViewColumn.CellTemplate>
                                                                                </GridViewColumn>
                                                                                <GridViewColumn Header="Yön" Width="60">
                                                                                        <GridViewColumn.CellTemplate>
                                                                                                <DataTemplate>
                                                                                                        <TextBlock Text="{Binding Side}" Foreground="{Binding Side, Converter={StaticResource SideToBrush}}" TextAlignment="Center"/>
                                                                                                </DataTemplate>
                                                                                        </GridViewColumn.CellTemplate>
                                                                                </GridViewColumn>
                                                                                <GridViewColumn Header="Adet" Width="80">
                                                                                        <GridViewColumn.CellTemplate>
                                                                                                <DataTemplate>
                                                                                                        <TextBlock Text="{Binding Quantity, StringFormat={}{0:#,0.####}}" TextAlignment="Right"/>
                                                                                                </DataTemplate>
                                                                                        </GridViewColumn.CellTemplate>
                                                                                </GridViewColumn>
                                                                                <GridViewColumn Header="Fiyat" Width="80">
                                                                                        <GridViewColumn.CellTemplate>
                                                                                                <DataTemplate>
                                                                                                        <TextBlock Text="{Binding Price, StringFormat={}{0:#,0.####}}" TextAlignment="Right"/>
                                                                                                </DataTemplate>
                                                                                        </GridViewColumn.CellTemplate>
                                                                                </GridViewColumn>
                                                                                <GridViewColumn Header="Durum" Width="80" DisplayMemberBinding="{Binding Status}"/>
                                                                        </GridView>
                                                                </ListView.View>
                                                        </ListView>
                                                </TabItem>
                                                <TabItem Header="Emir Geçmişi">
                                                        <ListView x:Name="OrderHistoryList">
                                                                <ListView.View>
                                                                        <GridView>
                                                                                <GridViewColumn Header="Sembol" Width="90">
                                                                                        <GridViewColumn.CellTemplate>
                                                                                                <DataTemplate>
                                                                                                        <TextBlock>
                                                                                                                <Run Text="{Binding BaseSymbol, Mode=OneWay}"/>
                                                                                                                <Run Text="/USDT" Foreground="Gray"/>
                                                                                                        </TextBlock>
                                                                                                </DataTemplate>
                                                                                        </GridViewColumn.CellTemplate>
                                                                                </GridViewColumn>
                                                                                <GridViewColumn Header="Yön" Width="60">
                                                                                        <GridViewColumn.CellTemplate>
                                                                                                <DataTemplate>
                                                                                                        <TextBlock Text="{Binding Side}" Foreground="{Binding Side, Converter={StaticResource SideToBrush}}" TextAlignment="Center"/>
                                                                                                </DataTemplate>
                                                                                        </GridViewColumn.CellTemplate>
                                                                                </GridViewColumn>
                                                                                <GridViewColumn Header="Adet" Width="80">
                                                                                        <GridViewColumn.CellTemplate>
                                                                                                <DataTemplate>
                                                                                                        <TextBlock Text="{Binding Quantity, StringFormat={}{0:#,0.####}}" TextAlignment="Right"/>
                                                                                                </DataTemplate>
                                                                                        </GridViewColumn.CellTemplate>
                                                                                </GridViewColumn>
                                                                                <GridViewColumn Header="Fiyat" Width="80">
                                                                                        <GridViewColumn.CellTemplate>
                                                                                                <DataTemplate>
                                                                                                        <TextBlock Text="{Binding Price, StringFormat={}{0:#,0.####}}" TextAlignment="Right"/>
                                                                                                </DataTemplate>
                                                                                        </GridViewColumn.CellTemplate>
                                                                                </GridViewColumn>
                                                                                <GridViewColumn Header="Durum" Width="80" DisplayMemberBinding="{Binding Status}"/>
                                                                                <GridViewColumn Header="Zaman" Width="120">
                                                                                        <GridViewColumn.CellTemplate>
                                                                                                <DataTemplate>
                                                                                                        <TextBlock Text="{Binding Time, StringFormat={}{0:HH:mm:ss}}" TextAlignment="Center"/>
                                                                                                </DataTemplate>
                                                                                        </GridViewColumn.CellTemplate>
                                                                                </GridViewColumn>
                                                                        </GridView>
                                                                </ListView.View>
                                                        </ListView>
                                                </TabItem>
                                                <TabItem Header="Trade Geçmişi">
                                                        <ListView x:Name="TradeHistoryList">
                                                                <ListView.View>
                                                                        <GridView>
                                                                                <GridViewColumn Header="Sembol" Width="90">
                                                                                        <GridViewColumn.CellTemplate>
                                                                                                <DataTemplate>
                                                                                                        <TextBlock>
                                                                                                                <Run Text="{Binding BaseSymbol, Mode=OneWay}"/>
                                                                                                                <Run Text="/USDT" Foreground="Gray"/>
                                                                                                        </TextBlock>
                                                                                                </DataTemplate>
                                                                                        </GridViewColumn.CellTemplate>
                                                                                </GridViewColumn>
                                                                                <GridViewColumn Header="Yön" Width="60">
                                                                                        <GridViewColumn.CellTemplate>
                                                                                                <DataTemplate>
                                                                                                        <TextBlock Text="{Binding Side}" Foreground="{Binding Side, Converter={StaticResource SideToBrush}}" TextAlignment="Center"/>
                                                                                                </DataTemplate>
                                                                                        </GridViewColumn.CellTemplate>
                                                                                </GridViewColumn>
                                                                                <GridViewColumn Header="Adet" Width="80">
                                                                                        <GridViewColumn.CellTemplate>
                                                                                                <DataTemplate>
                                                                                                        <TextBlock Text="{Binding Quantity, StringFormat={}{0:#,0.####}}" TextAlignment="Right"/>
                                                                                                </DataTemplate>
                                                                                        </GridViewColumn.CellTemplate>
                                                                                </GridViewColumn>
                                                                                <GridViewColumn Header="Fiyat" Width="80">
                                                                                        <GridViewColumn.CellTemplate>
                                                                                                <DataTemplate>
                                                                                                        <TextBlock Text="{Binding Price, StringFormat={}{0:#,0.####}}" TextAlignment="Right"/>
                                                                                                </DataTemplate>
                                                                                        </GridViewColumn.CellTemplate>
                                                                                </GridViewColumn>
                                                                                <GridViewColumn Header="Ücret" Width="80">
                                                                                        <GridViewColumn.CellTemplate>
                                                                                                <DataTemplate>
                                                                                                        <TextBlock Text="{Binding Fee, StringFormat={}{0:#,0.####}}" TextAlignment="Right"/>
                                                                                                </DataTemplate>
                                                                                        </GridViewColumn.CellTemplate>
                                                                                </GridViewColumn>
                                                                                <GridViewColumn Header="Net" Width="80">
                                                                                        <GridViewColumn.CellTemplate>
                                                                                                <DataTemplate>
                                                                                                        <TextBlock Text="{Binding NetProfit, StringFormat={}{0:#,0.####}}" TextAlignment="Right"/>
                                                                                                </DataTemplate>
                                                                                        </GridViewColumn.CellTemplate>
                                                                                </GridViewColumn>
                                                                                <GridViewColumn Header="Zaman" Width="150">
                                                                                        <GridViewColumn.CellTemplate>
                                                                                                <DataTemplate>
                                                                                                        <TextBlock Text="{Binding Time, StringFormat={}{0:yyyy-MM-dd HH:mm:ss}}" TextAlignment="Center"/>
                                                                                                </DataTemplate>
                                                                                        </GridViewColumn.CellTemplate>
                                                                                </GridViewColumn>
                                                                        </GridView>
                                                                </ListView.View>
                                                        </ListView>
                                                </TabItem>
                                        </TabControl>
                                </Expander>

                                <!-- ALARM GEÇMİŞİ -->
                                <Expander Grid.Column="2" IsExpanded="True" Padding="6,4">
                                        <Expander.Header>
                                                <DockPanel LastChildFill="False">
                                                        <TextBlock Foreground="{DynamicResource OnSurface}"
                                   Text="{Binding ElementName=AlertList, Path=Items.Count, StringFormat=Alarm Geçmişi ({0})}"
                                   FontWeight="Bold" VerticalAlignment="Center"/>
                                                        <StackPanel Orientation="Horizontal" DockPanel.Dock="Right">
                                                                <Button Content="CSV Dışa Aktar" Click="ExportAlertLog_Click" Margin="8,0,0,0"/>
                                                                <Button Content="Temizle"        Click="ClearAlertLog_Click"  Margin="8,0,0,0"/>
                                                        </StackPanel>
                                                </DockPanel>
                                        </Expander.Header>

                                        <ListView x:Name="AlertList" Margin="0,6,0,0"
                          Loaded="AlertList_Loaded"
                          SizeChanged="AlertList_SizeChanged">
                                                <ListView.View>
                                                        <GridView>
                                                                <GridViewColumn Header="Zaman"  Width="80"  DisplayMemberBinding="{Binding LocalTime}"/>
                                                                <GridViewColumn Header="Sembol" Width="110">
                                                                        <GridViewColumn.CellTemplate>
                                                                                <DataTemplate>
                                                                                        <TextBlock>
                                                                                                <Run Text="{Binding BaseSymbol, Mode=OneWay}"/>
                                                                                                <Run Text="/USDT" Foreground="Gray"/>
                                                                                        </TextBlock>
                                                                                </DataTemplate>
                                                                        </GridViewColumn.CellTemplate>
                                                                </GridViewColumn>
                                                                <GridViewColumn Header="Koşul"  Width="160" DisplayMemberBinding="{Binding TypeText}"/>
                                                                <GridViewColumn x:Name="MsgColumn" Header="Mesaj" Width="260">
                                                                        <GridViewColumn.CellTemplate>
                                                                                <DataTemplate>
                                                                                        <TextBlock Text="{Binding Message}"
                                                   TextTrimming="CharacterEllipsis"
                                                   ToolTip="{Binding Message}"/>
                                                                                </DataTemplate>
                                                                        </GridViewColumn.CellTemplate>
                                                                </GridViewColumn>
                                                        </GridView>
                                                </ListView.View>
                                        </ListView>
                                </Expander>

                                <!-- CÜZDAN BİLGİLERİ -->
                                <Expander Grid.Column="1" Header="Cüzdan" IsExpanded="True" Padding="6,4">
                                        <ListView x:Name="WalletList" Margin="0,6,0,0">
                                                <ListView.View>
                                                        <GridView>
                                                                <GridViewColumn Header="Varlık" Width="70">
                                                                        <GridViewColumn.CellTemplate>
                                                                                <DataTemplate>
                                                                                        <Border BorderBrush="{DynamicResource Divider}"
                                                                                                BorderThickness="0,0,1,1" Padding="2">
                                                                                                <TextBlock Text="{Binding Asset}"/>
                                                                                        </Border>
                                                                                </DataTemplate>
                                                                        </GridViewColumn.CellTemplate>
                                                                </GridViewColumn>
                                                                <GridViewColumn Header="Bakiye" Width="90">
                                                                        <GridViewColumn.CellTemplate>
                                                                                <DataTemplate>
                                                                                        <Border BorderBrush="{DynamicResource Divider}"
                                                                                                BorderThickness="0,0,1,1" Padding="2">
                                                                                                <TextBlock Text="{Binding Balance, StringFormat={}{0:#,0.00}}"
                                                                                                           HorizontalAlignment="Right"
                                                                                                           TextAlignment="Right"/>
                                                                                        </Border>
                                                                                </DataTemplate>
                                                                        </GridViewColumn.CellTemplate>
                                                                </GridViewColumn>
                                                                <GridViewColumn Header="Kullanılabilir" Width="90">
                                                                        <GridViewColumn.CellTemplate>
                                                                                <DataTemplate>
                                                                                        <Border BorderBrush="{DynamicResource Divider}"
                                                                                                BorderThickness="0,0,0,1" Padding="2">
                                                                                                <TextBlock Text="{Binding Available, StringFormat={}{0:#,0.00}}"
                                                                                                           HorizontalAlignment="Right"
                                                                                                           TextAlignment="Right"/>
                                                                                        </Border>
                                                                                </DataTemplate>
                                                                        </GridViewColumn.CellTemplate>
                                                                </GridViewColumn>
                                                        </GridView>
                                                </ListView.View>
                                        </ListView>
                                </Expander>
                        </Grid>
                </Grid>
        </DockPanel>
</Window>
